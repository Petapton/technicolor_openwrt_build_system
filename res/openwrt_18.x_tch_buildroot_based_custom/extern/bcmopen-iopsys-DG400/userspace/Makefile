#***********************************************************************
#
#  Copyright (c) 2007  Broadcom Corporation
#  All Rights Reserved
#
#***********************************************************************/

# GNUMAKEFLAGS := --output-sync=target

all:	public-include autobuild_dirs

CURR_DIR := $(shell pwd)
BUILD_DIR:=$(subst /userspace, /userspace,$(CURR_DIR))
BUILD_DIR:=$(word 1, $(BUILD_DIR))
export BUILD_DIR
include $(BUILD_DIR)/make.common

ifeq ($(wildcard ../targets/config.in),)
CONSUMER_BUILD=1
endif


MODSW_GLOBAL=1

# Check to see if any autodetect files are newer than the autogenerated makefile
DUMMY := $(shell if [ `ls -tr */*/*/autodetect makefile.modsw.autogen 2>/dev/null| tail -1` != "makefile.modsw.autogen" ] ; then \
	   rm -f makefile.modsw.autogen ; \
	fi )

include $(BUILD_DIR)/make.modsw




autobuild_dirs    : public-include $(AUTODIRS)

$(AUTODIRS) : public-include

public-include: $(BUILD_DIR)/cms_dmp_flags.h
	$(MAKE) -C public/include

.PHONY: public-include

.PHONY: autobuild_dirs

clean:
	@for dir in $(AUTODIRS); do \
	  $(MAKE) -C $$dir clean; \
	done
	@rm -f makefile.modsw.autogen
	@rm -f $(BUILD_DIR)/cms_dmp_flags.h
	@$(MAKE) -C public/include clean


